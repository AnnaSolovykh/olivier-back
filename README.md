# Back-End Repo for Node/React Practicum

This repository contains the backend code for Node/React Practicum. 
It provides the necessary instructions to set up and run the backend.

### Running the project

1. Clone the repository onto your local device (following steps):
```
git clone git@github.com:Code-the-Dream-School/dd-prac-team1-back.git
cd dd-prac-team1-back
npm install
```
2. Set up Mongo database by installing [MongoDB](https://www.mongodb.com/)
3. Obtain API key for [OPEN AI](https://platform.openai.com/account/api-keys)
4. Copy the `.env.example` file and rename it to `.env`: 
```
cp .env.example .env
```
5. Replace the placeholders with your specific values:

```PORT = <your_desired_port_number>
MONGO_URI = "<your_mongodb_connection_url>"
JWT_SECRET = <your_unique_jwt_secret_key>
JWT_LIFETIME = <your_desired_jwt_lifetime>
SESSION_SECRET = <your_unique_session_secret_key>
NODE_ENV=<your_environment>
OPENAI_API_KEY = <your_openai_api_secret_key>
```

6. Run `npm run start` to start the development server
7. The app will be served at <http://localhost:3000/>.
8. Your back-end server is now running. You can now run the front-end app.

# MongoDB Configuration

MongoDB is used to store user data, recipes, and manage user sessions. 
he database structure includes collections for users and recipes, as well as a session store for user authentication.

1. Session Configuration. Session handling is crucial for user authentication and maintaining user state. 
The express-session package is used along with connect-mongodb-session to manage sessions and store them in MongoDB.

2. User Schema. The user schema defines the structure of user data stored in the MongoDB database. 
It stores user information, including usernames, email addresses, and hashed passwords. 
The schema also includes methods for password hashing, JWT token creation, and password comparison

3. The recipe schema defines the structure of recipe data stored in the MongoDB database. 
It stores recipe information, including recipe name, ingredients, serving size, cooking instructions, nutrition info, meal preparation time, recipe category, special diet type, recipe tags, complexity level and meal image. 
It uses subdocuments for recipe ingredients and tags.

# Recipe CRUD (create, read, update, delete) Functionality

An overview of the CRUD (Create, Read, Update, Delete) backend functionality for recipes.
This functionality allows users to manage recipes, whether they are manually entered or generated by an AI assistant.

Endpoints: 

1. Endpoints:
- Fetch AI Recipe. This endpoint fetches a recipe using the OpenAI API based on user input:                                                     POST /api/v1/recipes
- Create AI Recipe. The created AI recipe is stored in the DB:                                                                                      POST /api/v1/recipes/add-ai
- Create Manual Recipe. This endpoint allows authenticated users to manually create a new recipe. The created recipe is stored in the database: POST /api/v1/recipes/add-manual
 -Get All Recipes. This endpoint retrieves all recipes created by the authenticated user, including both manually entered and AI-generated recipes: GET /api/v1/recipes
- Get Recipe by ID. Retrieves a specific recipe by its ID, whether it was manually entered or AI-generated:                                         GET /api/v1/recipes/:recipeId
- Update Recipe. Allows the authenticated user to update a specific recipe, whether it was manually entered or AI-generated.:                   PATCH /api/v1/recipes/:recipeId
- Delete Recipe. Allows the authenticated user to delete a specific recipe, whether it was manually entered or AI-generated:                        DELETE /api/v1/recipes/:recipeId

2. Authentication:
Users must be authenticated to use these endpoints. Authentication tokens can be obtained by logging in. Users can only create, retrieve, update, and delete recipes that they have created.

4. User-Recipe association
When a user creates a manual recipe or an AI-generated recipe, the 'recipeCreatedBy' field is set to the user's unique identifier. This ensures that each recipe is linked to the user who created it. When retrieving, updating, or deleting a recipe, the user's authentication token is used to identify the user. The user's token is verified, and the associated recipes are accessed or modified based on the user's authentication.

5. Error Handling
All responses follow a consistent format. When errors occur, appropriate HTTP status codes are returned along with error messages in the response body.

# Shopping List API

1. The Shopping List API provides functionality for users to create and manage their shopping lists. 
Users can add recipe ingredients to their shopping list, and duplicate ingredients will be summed up.

2. Endpoints    
    
    2.1. Add Recipe Ingredients to Shopping List
Endpoint: POST /api/v1/shopping-list/:recipeId
Description: Add ingredients of a specific recipe to the user's shopping list. Duplicated ingredients will be summed up.
Request Parameters:recipeId: ID of the recipe to add ingredients from
Authorization: Required (User must be authenticated)
Response: 201 Created if successful, with a JSON message indicating success.    
    2.2. Get User's Shopping List
Endpoint: GET /api/v1/shopping-list
Description: Retrieve the user's shopping list containing all added ingredients.
Authorization: Required (User must be authenticated)
Response: 200 OK with a JSON object representing the user's shopping list.
        2.3. DELETE Specific Ingredient in the Shopping list
Endpoint: DELETE /api/v1/shopping-list/:ingredientName
Description: Delete a specific ingredient from the shopping list by providing its name URL-encoded in the URL.
Authorization: Required (User must be authenticated). 
    Front-End Encoding/Decoding: Encoding: Before sending the request, need to encode the ingredient name using encodeURIComponent() to handle      spaces and special characters. Decoding: The server automatically decodes the URL-encoded ingredient name using decodeURIComponent() for    accurate processing.
Response: 200 OK with a JSON object representing the success message.
    2.4. DELETE the Shopping list
Endpoint: DELETE /api/v1/shopping-list/
Description: An authorized user can clear the entire shopping list
Authorization: Required (User must be authenticated). 
Response: 200 OK with a JSON object representing the success message.
    2.5. PUT Update Ingredient in Shopping list
Endpoint: PUT /api/v1/shopping-list/:ingredientName
Description: manage shopping list by providing of the user with the ability to update ingredient in the shopping list.
Authorization: Required (User must be authenticated)
Response: 200 OK with a JSON object representing the user's shopping list.

3. Usage
User is required to be authenticated.The recipe's ingredients added to the shopping list by sending a POST request to the appropriate endpoint with the recipe ID.The shopping list is retrieved by sending a GET request to the /shopping-list endpoint.
Duplicate ingredients from multiple recipes will be summed up in the shopping list.